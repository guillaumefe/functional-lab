<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Index des Vulnérabilités OWASP Top 10</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            padding-top: 50px;
        }
        .vulnerability-card {
            margin-bottom: 20px;
        }
        .header {
            margin-bottom: 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 3em;
            font-weight: bold;
        }
        .header p {
            font-size: 1.2em;
            color: #777;
        }
        .card.completed {
            background-color: #e0e0e0;
        }
        .card.completed .card-title {
            text-decoration: line-through;
        }
    </style>
</head>
<body>

    <div class="container header">
        <h1>OWASP Top 10 Vulnérabilités</h1>
        <p>Explorez les exemples pratiques des principales vulnérabilités de sécurité web</p>
    </div>

    <div class="container" id="vulnerability-container">
        <!-- Les vulnérabilités seront insérées ici dynamiquement -->
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            {{VULNERABILITIES_DATA}}

            let completedVulns = JSON.parse(localStorage.getItem('completedVulns')) || [];

            let categories = {};
            vulnerabilities.forEach(vuln => {
                if (!categories[vuln.category]) {
                    categories[vuln.category] = [];
                }
                categories[vuln.category].push(vuln);
            });

            const container = document.getElementById('vulnerability-container');

            for (let category in categories) {
                const categoryHeader = document.createElement('h2');
                categoryHeader.textContent = category.replace(/_/g, ' ');
                container.appendChild(categoryHeader);

                const row = document.createElement('div');
                row.className = 'row';

                categories[category].forEach(vuln => {
                    const col = document.createElement('div');
                    col.className = 'col-md-4 vulnerability-card';

                    const card = document.createElement('div');
                    card.className = 'card';
                    card.setAttribute('data-id', vuln.id);

                    if (completedVulns.includes(vuln.id)) {
                        card.classList.add('completed');
                    }

                    const cardBody = document.createElement('div');
                    cardBody.className = 'card-body';

                    const title = document.createElement('h5');
                    title.className = 'card-title';
                    title.textContent = vuln.title;

                    const description = document.createElement('p');
                    description.className = 'card-text';
                    description.textContent = vuln.description;

                    const link = document.createElement('a');
                    link.href = `http://localhost:${vuln.port}`;
                    link.className = 'btn btn-primary';
                    link.textContent = 'Accéder à la démonstration';

                    const button = document.createElement('button');
                    button.className = 'btn btn-secondary mark-completed';
                    button.textContent = completedVulns.includes(vuln.id) ? 'Marqué comme fait' : 'Marquer comme fait';
                    button.style.marginLeft = '10px';

                    button.addEventListener('click', function() {
                        toggleCompleted(vuln.id, card, button);
                    });

                    cardBody.appendChild(title);
                    cardBody.appendChild(description);
                    cardBody.appendChild(link);
                    cardBody.appendChild(button);
                    card.appendChild(cardBody);
                    col.appendChild(card);
                    row.appendChild(col);
                });

                container.appendChild(row);
            }

            function toggleCompleted(id, cardElement, buttonElement) {
                let index = completedVulns.indexOf(id);
                if (index === -1) {
                    completedVulns.push(id);
                    cardElement.classList.add('completed');
                    buttonElement.textContent = 'Marqué comme fait';
                } else {
                    completedVulns.splice(index, 1);
                    cardElement.classList.remove('completed');
                    buttonElement.textContent = 'Marquer comme fait';
                }
                localStorage.setItem('completedVulns', JSON.stringify(completedVulns));
            }
        });
    </script>
</body>
</html>
